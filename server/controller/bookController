const dataBase = require("../database/usersModel");

const bookController = {};

bookController.populateShelf = (req, res, next) => {
  const id = req.body[2].props._id;
  const readShelf = req.body[0];
  const unreadShelf = req.body[1];
  dataBase.findByIdAndUpdate(
    id,
    { bookShelfRead: readShelf, bookShelfUnread: unreadShelf },
    (err, results) => {
      if (err) {
        return next({
          log: "Express error handler caught populateShelf middleware error",
          status: 400,
          message: { err: "account query fail occurred" },
        });
      }
      return next();
    }
  );
};

bookController.getBooks = (req, res, next) => {
  const { id } = req.params;
  dataBase.findById(id, (err, results) => {
    if (err) {
      return next({
        log: "Express error handler caught getBooks middleware error",
        status: 400,
        message: { err: "account query fail occurred" },
      });
    }
    res.locals.readShelf = results.bookShelfRead;
    res.locals.unreadShelf = results.bookShelfUnread;
    return next();
  });
};

module.exports = bookController;
